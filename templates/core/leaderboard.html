{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<section class="section-pad bg-light-section position-relative overflow-hidden">
    <div class="container position-relative z-1">
        <div class="text-center mb-5">
            <span class="badge badge-modern bg-primary-subtle text-primary mb-3">
                <i class="bi bi-trophy-fill me-1"></i> {% if selected_test %}
                {{ selected_test.title }}
                Ranking
                {% else %}
                {% trans "Global Rankings" %}
                {% endif %}
            </span>
            <h1 class="display-4 fw-bold mb-3">
                {% if selected_test %}
                {{ selected_test.title }}
                {% else %}
                {% trans "Wall of Fame" %}
                {% endif %}
            </h1>

         
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="glass-panel p-4 bg-white shadow-sm">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="py-3 ps-4" style="width: 80px;">{% trans "Rank" %}</th>
                                    <th class="py-3">{% trans "Student" %}</th>
                                    <th class="py-3 text-center">{% trans "Tests Attempted" %}</th>
                                    <th class="py-3 pe-4 text-end">{% trans "Total Score" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for entry in leaderboard %}
                                <tr
                                    class="{% if request.user.is_authenticated and request.user.id == entry.user_id %}table-primary border-primary{% endif %} transition-all hover-lift">
                                    <td class="ps-4 fw-bold">
                                        {% if entry.rank == 1 %}
                                        <span class="fs-4 text-warning">ðŸ¥‡</span>
                                        {% elif entry.rank == 2 %}
                                        <span class="fs-4 text-secondary">ðŸ¥ˆ</span>
                                        {% elif entry.rank == 3 %}
                                        <span class="fs-4 text-danger">ðŸ¥‰</span>
                                        {% else %}
                                        <span class="badge bg-light text-dark border rounded-pill px-3">#{{ entry.rank
                                            }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle me-3 fw-bold text-white d-flex align-items-center justify-content-center"
                                                style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #0056D2, #00C6FF);">
                                                {{ entry.display_name|first|upper }}
                                            </div>
                                            <div>
                                                <div class="fw-bold text-dark">
                                                    {{ entry.display_name }}
                                                    {% if request.user.is_authenticated and request.user.id == entry.user_id %}
                                                    <span class="badge bg-primary ms-2 rounded-pill"
                                                        style="font-size: 0.6rem; vertical-align: middle;">YOU</span>
                                                    {% endif %}
                                                </div>
                                                {% if entry.rank <= 3 %} <span
                                                    class="badge bg-warning bg-opacity-10 text-warning d-inline-block"
                                                    style="font-size: 0.65rem;">Top Performer</span>
                                                    {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-secondary bg-opacity-10 text-secondary rounded-pill px-3">
                                            {{ entry.tests_taken }}
                                        </span>
                                    </td>
                                    <td class="pe-4 text-end">
                                        <div class="fw-bold fs-5 text-primary">{{ entry.total_score|floatformat:0 }}
                                        </div>
                                        <small class="text-muted">points</small>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center py-5 text-muted">
                                        <i class="bi bi-bar-chart fs-1 d-block mb-3 opacity-25"></i>
                                        {% trans "Leaderboard is updating. Check back soon!" %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination Removed for Top 20 View -->
                    {% if leaderboard|length > 20 %}
                    <div class="row mt-2">
                        <div class="col-12 text-center text-muted fst-italic">
                            <small>... Showing your rank amongst top performers ...</small>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .avatar-circle {
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .hover-lift:hover {
        transform: translateY(-2px);
        z-index: 2;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .table-primary {
        background-color: rgba(0, 86, 210, 0.05) !important;
        --bs-table-bg: transparent;
    }
</style>
{% endblock %}